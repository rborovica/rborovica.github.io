{% assign projects = site.data.projects %}
{% assign publications = site.data.publications %}
{% assign publications_page = "/index.html" | relative_url %}
<h2>{{ projects.heading }}</h2>
<p>{{ projects.intro }}</p>
<div class="card-grid">
  {% for card in projects.projects %}
    <article class="card">
      <h3>{{ card.title }}</h3>
      <p>{{ card.text }}</p>
      {% if card.pubs %}
        <p class="project-pubs"><strong>[{% for pub in card.pubs %}{% assign target_year = publications.years | where: "year", pub.year | first %}{% if target_year %}{% assign matching_entries = target_year.entries | where: "venue", pub.venue %}{% if matching_entries.size > 0 %}{% assign venue_slug = pub.venue | slugify %}{% if matching_entries.size > 1 %}{% assign anchor = "pub-" | append: pub.year | append: "-" | append: venue_slug %}{% else %}{% assign anchor_index = "" %}{% for entry in target_year.entries %}{% if entry.venue == pub.venue and anchor_index == "" %}{% assign anchor_index = forloop.index %}{% endif %}{% endfor %}{% assign anchor = "pub-" | append: pub.year | append: "-" | append: venue_slug | append: "-" | append: anchor_index %}{% endif %}<a href="{{ publications_page }}#{{ anchor }}">{{ pub.label }}</a>{% else %}<a href="{{ publications_page }}#publications">{{ pub.label }}</a>{% endif %}{% else %}<a href="{{ publications_page }}#publications">{{ pub.label }}</a>{% endif %}{% unless forloop.last %}, {% endunless %}{% endfor %}]</strong></p>
      {% endif %}
    </article>
  {% endfor %}
</div>
